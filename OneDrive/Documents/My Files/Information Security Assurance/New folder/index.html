<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
    <title>CryptoTool</title>
</head>
<body style="background-image: url('/img/bg.jpg'); overflow: hidden;">
    
    
    <div class="container-fluid" id="particles-js" >
        <div class="row" >
            <div class="col-md-12">
                <!-- Button trigger modal -->
                <div class="container-fluid" style="position:fixed; pointer-events: none;">
                    <div class="row mt-5">
                        <div class="md-12 text-center mt-5">
                            <h1 class=" head-text text-center mt-5" style="font-size: 12vw; font-family: Papyrus;">CryptoTool</h1>
                            <h5 class=" head-text text-center" style="font-size: 3vw; font-family: Papyrus; color: White;">Monoalphabetic Cipher Method</h5>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-primary mt-5 m-2 " data-bs-toggle="modal" data-bs-target="#Encryption" style="pointer-events: fill;">
                                Encrypt Text
                            </button>
                            <button type="button" class="btn btn-primary mt-5 m-2 " data-bs-toggle="modal" data-bs-target="#Decryption" style="pointer-events: fill;">
                                Decrypt Text
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Modal for encryption -->
                <div class="modal fade" id="Encryption" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="form1">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">EncrypTool</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            
                            <div class="mb-3">
                                <label for="textInput" class="form-label">Your Text File</label>
                                <input name="textInput" type="file" class="form-control" id="fileInput" accept=".txt">
                            </div>
                            <div class="mb-3">
                                <select id="keyOpt" class="form-select" aria-label="Default select example">
                                    <option selected>Select Key</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <button id="encrypt" type="button" class="btn btn-primary">Encrypt</button>
                                <button type="button" class="btn btn-warning" onclick="res1();">Reset</button>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Encrypted Text</label>
                                <textarea class="form-control text-uppercase " id="encodedText" rows="2" disabled></textarea>
                            </div>
                            <div class="container mb-3">
                                <div class="row">
                                    <div class="col-md-7">
                                        <input class="form-control w-40" id="encodedFilename" required placeholder="File name here" required>
                                    </div>
                                    <div class="col-md-5">
                                         <button id="downloadEText" type="button" class="btn btn-success">Download File</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
                        </div>
                    </form>
                    </div>
                    </div>
                </div>


                <!-- Modal for Decryption-->
                <div class="modal fade" id="Decryption" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <form action="" class="form2">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">DecrypTool</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="textInput" class="form-label">Encoded Text File</label>
                                <input type="file" class="form-control" id="cipherFileInput" accept=".txt" required>
                            </div>
                            <div class="mb-3">
                                <select id="keyOpt2" class="form-select" aria-label="Default select example">
                                    <option selected>Select Key</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary" id="decrypt">Decrypt</button>
                                <button type="button" class="btn btn-warning" onclick="res2();">Reset</button>
                            </div>
                            <div class="mb-3">
                                <label for="textOutput" class="form-label">Decrypted Text</label>
                                <textarea class="form-control text-uppercase" id="decodedText" rows="2"></textarea>
                            </div>
                            <div class="container mb-3">
                                <div class="row">
                                    <div class="col-md-7">
                                        <input class="form-control w-40" id="decodedFilename" required placeholder="File name here" required>
                                    </div>
                                    <div class="col-md-5">
                                         <button id="downloadDText" type="button" class="btn btn-success">Download File</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
                        </div>
                    </form>
                    </div>
                    </div>
                </div> 
            </div>
        </div>
    </div>
    
    <script src="js/particles.js"></script>
    <script src="js/app.js"></script>
    <script type="text/javascript">


        /////
            //ENCRYPTION
        /////

        //READ TEXT FILE CONTENT
        document.getElementById('fileInput').addEventListener('change', function(event){
            event.preventDefault();

            var fr = new FileReader();
            fr.onload = function(){
                let fileContent = "";

                fileContent = fr.result;

                function substitutionCipher(text, key, encrypt) {
                    const alphabet = "abcdefghijklmnopqrstuvwxyz";
                    const keyAlphabet = key.toLowerCase() + alphabet.replace(new RegExp(`[${key}]`, 'gi'), '');
                    let result = "";
                        for (let i = 0; i < text.length; i++) {
                            const char = text[i].toLowerCase();
                            const index = alphabet.indexOf(char);
                            if (index === -1) {
                            // non-alphabetic characters are not encrypted or decrypted
                            result += char;
                            } else {
                                const encryptedChar = keyAlphabet[index];
                                const decryptedChar = alphabet[keyAlphabet.indexOf(char)];
                                result += encrypt ? encryptedChar : decryptedChar;
                            }
                        }
                            return result;
                }

                document.getElementById('encrypt').addEventListener('click',  function() {
                    var plaintext = fileContent;
                    var key = "";
                    var keyOpt = document.getElementById("keyOpt").value;
                        if(keyOpt == 1){
                            key = "BCDEFGHIJKLMNOPQRSTUVWXYZA";
                        }else if(keyOpt == 2){
                            key = "CDEFGHIJKLMNOPQRSTUVWXYZAB";
                        }else if(keyOpt == 3){
                            key = "DEFGHIJKLMNOPQRSTUVWXYZABC";
                        }else if(keyOpt == 4){
                            key = "EFGHIJKLMNOPQRSTUVWXYZABCD";
                        }else if(keyOpt == 5){
                            key = "FGHIJKLMNOPQRSTUVWXYZABCDE";
                        }else if(keyOpt == 6){
                            key = "GHIJKLMNOPQRSTUVWXYZABCDEF";
                        }else if(keyOpt == 7){
                            key = "HIJKLMNOPQRSTUVWXYZABCDEFG";
                        }else if(keyOpt == 8){
                            key = "IJKLMNOPQRSTUVWXYZABCDEFGH";
                        }else if(keyOpt == 9){
                            key = "JKLMNOPQRSTUVWXYZABCDEFGHI";
                        }else if(keyOpt == 10){
                            key = "KLMNOPQRSTUVWXYZABCDEFGHIJ";
                        }
                    const ciphertext = substitutionCipher(plaintext, key, true);
                    document.getElementById("encodedText").value = ciphertext;

                });  
            }
            fr.readAsText(this.files[0]);
        });

        /////
            //DECRYPTION
        /////
         //READ TEXT FILE CONTENT
        document.getElementById('cipherFileInput').addEventListener('change', function(event){
            event.preventDefault();

            var fr = new FileReader();
            fr.onload = function(){
                let fileContent2 = "";

                fileContent2 = fr.result;

                function substitutionCipherDecrypt(text, key, encrypt) {
                    const alphabet = "abcdefghijklmnopqrstuvwxyz";
                    const keyAlphabet = alphabet.toLowerCase() + key.replace(new RegExp(`[${key}]`, 'gi'), '');
                    let result = "";
                        for (let i = 0; i < text.length; i++) {
                            const char = text[i].toLowerCase();
                            const index = alphabet.indexOf(char);
                            if (index === -1) {
                            // non-alphabetic characters are not encrypted or decrypted
                            result += char;
                            } else {
                                const encryptedChar = keyAlphabet[index];
                                const decryptedChar = key[keyAlphabet.indexOf(char)];
                                result += encrypt ? encryptedChar : decryptedChar;
                            }
                        }
                            return result;
                }

                document.getElementById('decrypt').addEventListener('click',  function() {
                    var ciphertext = fileContent2;
                    var key2 = "";
                    var keyOpt2 = document.getElementById("keyOpt2").value;
                        if(keyOpt2 == 1){
                            key2 = "ZABCDEFGHIJKLMNOPQRSTUVWXY";
                        }else if(keyOpt2 == 2){
                            key2 = "YZABCDEFGHIJKLMNOPQRSTUVWX";
                        }else if(keyOpt2 == 3){
                            key2 = "XYZABCDEFGHIJKLMNOPQRSTUVW";
                        }else if(keyOpt2 == 4){
                            key2 = "WXYZABCDEFGHIJKLMNOPQRSTUV";
                        }else if(keyOpt2 == 5){
                            key2 = "VWXYZABCDEFGHIJKLMNOPQRSTU";
                        }else if(keyOpt2 == 6){
                            key2 = "UVWXYZABCDEFGHIJKLMNOPQRST";
                        }else if(keyOpt2 == 7){
                            key2 = "TUVWXYZABCDEFGHIJKLMNOPQRS";
                        }else if(keyOpt2 == 8){
                            key2 = "STUVWXYZABCDEFGHIJKLMNOPQR";
                        }else if(keyOpt2 == 9){
                            key2 = "RSTUVWXYZABCDEFGHIJKLMNOPQ";
                        }else if(keyOpt2 == 10){
                            key2 = "QRSTUVWXYZABCDEFGHIJKLMNOP";
                        }
                    const decryptedtext = substitutionCipherDecrypt(ciphertext, key2, false);
                    document.getElementById("decodedText").value = decryptedtext;
                });
        
            }
            fr.readAsText(this.files[0]);
        });

        //////////////////////////////// Download Encoded
        function encodedDownloadFile(filename, content) {
                // It works on all HTML5 Ready browsers as it uses the download attribute of the <a> element:
                    const element = document.createElement('a');
                    
                    //A blob is a data type that can store binary data
                    // “type” is a MIME type
                    // It can have a different value, based on a file you want to save
                    const blob = new Blob([content], { type: 'plain/text' });
                    //createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.
                    const fileUrl = URL.createObjectURL(blob);
                    
                    //setAttribute() Sets the value of an attribute on the specified element.
                    element.setAttribute('href', fileUrl); //file location
                    element.setAttribute('download', filename); // file name
                    element.style.display = 'none';
                    
                    //use appendChild() method to move an element from one element to another
                    document.body.appendChild(element);
                    element.click();
                    
                    //The removeChild() method of the Node interface removes a child node from the DOM and returns the removed node
                    document.body.removeChild(element);
                };
    
        /////////////////////////////// Download Decoded

        function decodedDownloadFile(filename, content) {
                // It works on all HTML5 Ready browsers as it uses the download attribute of the <a> element:
                    const element = document.createElement('a');
                    
                    //A blob is a data type that can store binary data
                    // “type” is a MIME type
                    // It can have a different value, based on a file you want to save
                    const blob = new Blob([content], { type: 'plain/text' });
                    //createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.
                    const fileUrl = URL.createObjectURL(blob);
                    
                    //setAttribute() Sets the value of an attribute on the specified element.
                    element.setAttribute('href', fileUrl); //file location
                    element.setAttribute('download', filename); // file name
                    element.style.display = 'none';
                    
                    //use appendChild() method to move an element from one element to another
                    document.body.appendChild(element);
                    element.click();
                    
                    //The removeChild() method of the Node interface removes a child node from the DOM and returns the removed node
                    document.body.removeChild(element);
                };

                
                window.onload = () => {
                    document.getElementById('downloadEText').addEventListener('click', e => {
                        
                        //The value of the file name input box
                        const filenameInput = document.getElementById('encodedFilename').value;
                        const filename = filenameInput + ".txt";
                        //The value of what has been input in the textarea
                        const content = document.getElementById('encodedText').value.toUpperCase();
                        
                        // The && (logical AND) operator indicates whether both operands are true. If both operands have nonzero values, the result has the value 1 . Otherwise, the result has the value 0.
                        
                            if (filename && content) {
                            encodedDownloadFile(filename, content);
                            }
                        });

                    document.getElementById('downloadDText').addEventListener('click', e => {
                        
                        //The value of the file name input box
                        const filenameInput = document.getElementById('decodedFilename').value;
                        const filename = filenameInput + ".txt";
                        //The value of what has been input in the textarea
                        const content = document.getElementById('decodedText').value.toUpperCase();
                        
                        // The && (logical AND) operator indicates whether both operands are true. If both operands have nonzero values, the result has the value 1 . Otherwise, the result has the value 0.
                        
                            if (filename && content) {
                            decodedDownloadFile(filename, content);
                            }
                        });
                };

                function res1(){
                   document.getElementById('form1').reset();
                }
                function res2(){
                   document.getElementById('form2').reset();
                }
       

        //Modal Function
        var myModal = document.getElementById('myModal')
        var myInput = document.getElementById('myInput')

        myModal.addEventListener('shown.bs.modal', function () {
            myInput.focus()
        })

        
    </script>
</body>
</html>